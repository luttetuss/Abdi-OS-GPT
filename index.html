<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ABDI OS 9.0 | LAMBO EDITION</title>
    
    <!-- EXTERNAL ASSETS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@300;700&family=Permanent+Marker&display=swap');

        :root {
            --neon-cyan: #00f3ff;
            --neon-lambo: #f5a623;
            --hud-bg: rgba(5, 5, 10, 0.95);
        }

        body {
            background: #000; color: #fff; font-family: 'Chakra Petch', sans-serif;
            overflow: hidden; height: 100vh; touch-action: manipulation;
        }

        /* MAP DARK MODE */
        #map-layer { position: absolute; inset: 0; z-index: 0; background: #000; }
        .leaflet-layer { filter: invert(100%) hue-rotate(180deg) brightness(0.4) contrast(1.3) saturate(0.2); }

        /* HUD ELEMENTS */
        .glass-hud {
            background: var(--hud-bg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            clip-path: polygon(15px 0, 100% 0, 100% calc(100% - 15px), calc(100% - 15px) 100%, 0 100%, 0 15px);
        }

        .lambo-mode-active {
            --neon-cyan: #ffaa00;
            border-color: #ffaa00 !important;
            box-shadow: 0 0 40px rgba(255, 170, 0, 0.3);
        }

        /* SPEEDOMETER */
        .speed-val { font-size: 6rem; font-weight: 900; font-style: italic; line-height: 0.8; }
        .glow-text { text-shadow: 0 0 20px var(--neon-cyan); }

        /* GAS PEDAL */
        #gas-btn {
            background: linear-gradient(180deg, #222 0%, #000 100%);
            border-bottom: 8px solid #444;
            transition: all 0.05s;
        }
        #gas-btn:active {
            transform: translateY(6px);
            border-bottom: 2px solid #ff0000;
            box-shadow: inset 0 0 50px rgba(255, 0, 0, 0.4);
        }

        .driver-icon {
            font-size: 30px; color: var(--neon-cyan);
            filter: drop-shadow(0 0 10px var(--neon-cyan));
        }

        /* ANIMATIONS */
        @keyframes rumble {
            0% { transform: translate(1px, 1px); }
            50% { transform: translate(-1px, -1px); }
            100% { transform: translate(1px, -1px); }
        }
        .engine-rumble { animation: rumble 0.05s infinite; }
    </style>
</head>
<body>

    <div id="map-layer"></div>

    <!-- BOOT SCREEN -->
    <div id="boot" class="fixed inset-0 z-[100] bg-black flex flex-col items-center justify-center">
        <div class="text-center">
            <h1 class="text-5xl font-black italic text-white tracking-tighter">ABDI_OS <span class="text-red-600">v9.0</span></h1>
            <p class="text-[10px] text-gray-500 mt-2 tracking-[0.3em]">OPTIMUS NAJS SPECIAL EDITION</p>
        </div>
        <button onclick="app.start()" class="mt-16 px-12 py-5 border-2 border-cyan-500 text-cyan-500 font-bold hover:bg-cyan-500 hover:text-black transition-all">
            IGNITE CYBER-HUSTLE
        </button>
    </div>

    <!-- MAIN UI -->
    <div class="fixed inset-0 z-50 flex flex-col justify-between p-6 pointer-events-none">
        
        <!-- HEADER: Profile & Speed -->
        <header class="flex justify-between items-start pointer-events-auto">
            <div class="glass-hud p-4 flex items-center gap-4 border-l-4 border-cyan-500" id="profile-box">
                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Abdi&backgroundColor=000000&top=shortHair&accessories=eyepatch&facialHair=magnum" 
                     class="w-16 h-16 rounded-lg bg-black">
                <div>
                    <h2 class="font-bold text-white uppercase text-xs tracking-widest">Driver</h2>
                    <p class="text-cyan-400 font-black italic">OPTIMUS NAJS</p>
                    <p id="abdi-voice-box" class="text-[9px] text-gray-400 mt-1 italic w-32 truncate">System standby...</p>
                </div>
            </div>

            <div class="text-right">
                <div class="flex items-baseline justify-end gap-2">
                    <span id="speed-display" class="speed-val text-white glow-text">0</span>
                    <span class="text-2xl font-black italic text-cyan-500">KM/H</span>
                </div>
                <div class="w-48 h-1.5 bg-gray-800 rounded-full mt-2 overflow-hidden ml-auto">
                    <div id="rpm-bar" class="h-full bg-gradient-to-r from-cyan-500 to-red-600 w-0 transition-all duration-75"></div>
                </div>
            </div>
        </header>

        <!-- FOOTER: Controls -->
        <footer class="pointer-events-auto grid grid-cols-3 gap-6 items-end">
            
            <!-- GEARBOX -->
            <div class="glass-hud p-4 space-y-3 flex flex-col items-center">
                <span class="text-[10px] text-gray-500">GEAR</span>
                <span id="gear-display" class="text-4xl font-black text-white italic">N</span>
                <div class="flex gap-2 w-full">
                    <button onclick="app.shift(-1)" class="flex-1 py-3 bg-gray-900 rounded border border-gray-700 text-xs">-</button>
                    <button onclick="app.shift(1)" class="flex-1 py-3 bg-gray-900 rounded border border-gray-700 text-xs">+</button>
                </div>
            </div>

            <!-- GAS PEDAL -->
            <button id="gas-btn" 
                    onmousedown="app.gas(true)" onmouseup="app.gas(false)"
                    ontouchstart="app.gas(true)" ontouchend="app.gas(false)"
                    class="h-44 rounded-t-3xl flex flex-col items-center justify-center relative overflow-hidden">
                <span class="text-3xl font-black italic text-white z-10">GASAAAA</span>
                <div id="gas-glow" class="absolute inset-0 bg-red-600 opacity-0 transition-opacity"></div>
            </button>

            <!-- EXTRA -->
            <div class="flex flex-col gap-3">
                <button onclick="app.toggleLambo()" class="glass-hud p-4 text-[10px] font-black uppercase text-orange-500 border-orange-500">
                    Lambo Mode
                </button>
                <button onclick="app.voice.speak('Valla flytta på er, Optimus Najs kommer!', true)" class="glass-hud p-4 text-[10px] font-black uppercase text-red-500 border-red-500">
                    DOMINERA
                </button>
            </div>
        </footer>
    </div>

    <!-- AUDIO FILES -->
    <audio id="bg-music" loop src="ice.m4a"></audio>

    <script>
        class AbdiOS {
            constructor() {
                this.speed = 0;
                this.rpm = 800;
                this.gear = 0; // 0 = N
                this.isGas = false;
                this.lamboMode = false;
                this.map = null;
                this.marker = null;
                
                // Voice Engine
                this.voice = {
                    speak: (text, priority = false) => {
                        if (window.speechSynthesis.speaking && !priority) return;
                        window.speechSynthesis.cancel();
                        const msg = new SpeechSynthesisUtterance(text);
                        msg.lang = 'sv-SE';
                        msg.pitch = this.lamboMode ? 0.5 : 0.8;
                        msg.rate = 1.0;
                        document.getElementById('abdi-voice-box').innerText = text;
                        window.speechSynthesis.speak(msg);
                    }
                };
            }

            start() {
                gsap.to("#boot", { y: "-100%", duration: 1.2, ease: "expo.inOut", onComplete: () => {
                    document.getElementById('boot').style.display = 'none';
                    const audio = document.getElementById('bg-music');
                    audio.volume = 0.3;
                    audio.play().catch(e => console.log("Audio play blocked, needs user interaction."));
                    this.initMap();
                    this.voice.speak("Systemet är redo, Optimus Najs. Kolla baksätet... jag skoja bror, bara kör!");
                    this.tick();
                }});
            }

            initMap() {
                this.map = L.map('map-layer', { zoomControl: false }).setView([55.605, 13.000], 16);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(this.map);
                const icon = L.divIcon({
                    className: 'custom-car',
                    html: '<i class="fas fa-location-arrow driver-icon" id="car-arrow"></i>',
                    iconSize: [30, 30]
                });
                this.marker = L.marker([55.605, 13.000], {icon: icon}).addTo(this.map);
                
                if(navigator.geolocation) {
                    navigator.geolocation.watchPosition(pos => {
                        const newPos = [pos.coords.latitude, pos.coords.longitude];
                        this.map.panTo(newPos);
                        this.marker.setLatLng(newPos);
                        if(pos.coords.heading) {
                            document.getElementById('car-arrow').style.transform = `rotate(${pos.coords.heading - 45}deg)`;
                        }
                    });
                }
            }

            gas(active) {
                this.isGas = active;
                document.getElementById('gas-glow').style.opacity = active ? "0.4" : "0";
            }

            shift(dir) {
                this.gear = Math.max(0, Math.min(6, this.gear + dir));
                document.getElementById('gear-display').innerText = this.gear === 0 ? 'N' : this.gear;
                if(this.gear > 0) this.voice.speak("Växel " + this.gear);
                else this.voice.speak("Friläge bror!");
            }

            toggleLambo() {
                this.lamboMode = !this.lamboMode;
                const profile = document.getElementById('profile-box');
                if(this.lamboMode) {
                    profile.classList.add('lambo-mode-active');
                    this.voice.speak("LAMBO V12 AKTIVERAD! GASA NU FÖR FAN!", true);
                } else {
                    profile.classList.remove('lambo-mode-active');
                    this.voice.speak("Tillbaka till Volvo-mode.");
                }
            }

            tick() {
                // Physics
                if (this.isGas) {
                    this.rpm += this.lamboMode ? 400 : 200;
                    if (this.gear > 0) this.speed += (this.gear * 0.5);
                } else {
                    this.rpm -= 100;
                    this.speed *= 0.98;
                }

                // Limits
                this.rpm = Math.max(800, Math.min(this.rpm, 9000));
                this.speed = Math.max(0, this.speed);

                // Update UI
                document.getElementById('speed-display').innerText = Math.floor(this.speed);
                document.getElementById('rpm-bar').style.width = (this.rpm / 9000 * 100) + "%";
                
                // Visual Rumble
                if(this.rpm > 7000) document.body.classList.add('engine-rumble');
                else document.body.classList.remove('engine-rumble');

                if(Math.random() > 0.997) this.randomComment();

                requestAnimationFrame(() => this.tick());
            }

            randomComment() {
                const lines = ["Snyggt Optimus!", "Valla, Aina bakom oss!", "Kör inte på trottoaren!", "Dra upp volymen bror!"];
                this.voice.speak(lines[Math.floor(Math.random()*lines.length)]);
            }
        }

        const app = new AbdiOS();
    </script>
</body>
</html>
